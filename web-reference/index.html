<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"> 
    <meta property="og:image" content="https://raw.githubusercontent.com/serafi0620/Photographic_mosaic/main/hi-blueming-photographic-moaisc/thumbnail.png">
    <title>Photograpic mosaic</title>
    <link rel="stylesheet" href="app/leaflet.css" />
    <link rel="stylesheet" href="app/Control.FullScreen.css" />
    <link rel="stylesheet" href="app/easy-button.css" />
    <link rel="stylesheet" href="app/help-table.css" />
    <link rel="stylesheet" href="app/leaflet-search.css" />
    <style type="text/css">
        html, body, #AndreaMosaic {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            background: black;
        }
        
        /* 팝업 오버레이: 배경을 어둡게 하고 중앙 정렬을 수행 */
        .modal-overlay {
            display: none; /* 초기값 숨김 */
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10000; /* Leaflet 지도보다 위에 뜨도록 설정 */
            justify-content: center;
            align-items: center;
        }

        /* 팝업 창 본체 디자인 */
        .modal-content {
            background: white;
            width: 350px;
            max-width: 90%;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            overflow: hidden;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 팝업 상단 텍스트 영역 */
        .modal-body {
            padding: 30px 20px;
            text-align: center;
        }

        .modal-body h2 {
            margin-top: 0;
            color: #333;
            font-size: 22px;
        }

        .modal-body p {
            color: #666;
            font-size: 15px;
            line-height: 1.5;
        }

        /* 하단 버튼 영역 */
        .modal-footer {
            display: flex;
            border-top: 1px solid #eee;
            background: #f9f9f9;
        }

        .modal-footer button {
            flex: 1;
            padding: 15px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            background: none;
            transition: background 0.2s;
        }

        .modal-footer button:hover {
            background-color: #f0f0f0;
        }

        .btn-close {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <!-- 팝업 구조: "오늘 하루 보지 않기" 버튼을 제거함 -->
    <div id="myModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-body">
                <h2>🎉 하이블루밍 1주년 🎉</h2>
                <p>
                    - 더블 클릭: 장면의 다시보기 유튜브로 이동
                    <br>
                    <br>─────하이블루밍─────
                    <br>
                    🐹🔍 하네 
                    <a href="https://chzzk.naver.com/live/7b9c6553913c755812ef2cd9fbe1dc5c" target="_blank" style="text-decoration: none;">
                        <img src="https://ssl.pstatic.net/static/nng/glive/icon/favicon.png" width="16" height="16" alt="치지직" style="vertical-align: middle; margin-left: 4px;">
                    </a>
                    <a href="https://www.youtube.com/watch?v=NTpZsN7qviE" target="_blank" style="text-decoration: none;">
                        <img src="https://www.google.com/s2/favicons?sz=64&domain=youtube.com" width="16" height="16" alt="유튜브" style="vertical-align: middle; margin-left: 2px;">
                    </a>
                    <br>
                    🎠🫧 온하루 
                    <a href="https://chzzk.naver.com/live/0f61ae00c2aef2b789dc009e51cbcc5a" target="_blank" style="text-decoration: none;">
                        <img src="https://ssl.pstatic.net/static/nng/glive/icon/favicon.png" width="16" height="16" alt="치지직" style="vertical-align: middle; margin-left: 4px;">
                    </a>
                    <a href="https://www.youtube.com/@otw_onharu" target="_blank" style="text-decoration: none;">
                        <img src="https://www.google.com/s2/favicons?sz=64&domain=youtube.com" width="16" height="16" alt="유튜브" style="vertical-align: middle; margin-left: 2px;">
                    </a>
                    <br>
                    🤖⌚ 김아테 
                    <a href="https://chzzk.naver.com/live/f42e97f59c3177b8686dccfbf90792dd" target="_blank" style="text-decoration: none;">
                        <img src="https://ssl.pstatic.net/static/nng/glive/icon/favicon.png" width="16" height="16" alt="치지직" style="vertical-align: middle; margin-left: 4px;">
                    </a>
                    <a href="https://www.youtube.com/@otw_Ate" target="_blank" style="text-decoration: none;">
                        <img src="https://www.google.com/s2/favicons?sz=64&domain=youtube.com" width="16" height="16" alt="유튜브" style="vertical-align: middle; margin-left: 2px;">
                    </a>
                    <br>
                    🍀🎶 오토노 소리 
                    <a href="https://chzzk.naver.com/live/2e5c0e7ce8321194127e4d79c83c36d4" target="_blank" style="text-decoration: none;">
                        <img src="https://ssl.pstatic.net/static/nng/glive/icon/favicon.png" width="16" height="16" alt="치지직" style="vertical-align: middle; margin-left: 4px;">
                    </a>
                    <a href="https://www.youtube.com/@otw_sori" target="_blank" style="text-decoration: none;">
                        <img src="https://www.google.com/s2/favicons?sz=64&domain=youtube.com" width="16" height="16" alt="유튜브" style="vertical-align: middle; margin-left: 2px;">
                    </a>

                    <br>
                    <br>────소스코드────
                    <br>
                    
                    <a href="https://colab.research.google.com/github/serafi0620/Photographic_mosaic/blob/main/3_HI_blueming_photographic_mosaic.ipynb" target="_blank" style="text-decoration: none;">
                        google colab 
                        <img src="https://img.icons8.com/?size=256&id=lOqoeP2Zy02f&format=png" width="16" height="16" alt="치지직" style="vertical-align: middle; margin-left: 4px;">
                    </a>
                    <br>
                    <a href="https://github.com/serafi0620/Photographic_mosaic" target="_blank" style="text-decoration: none;">
                        github
                        <img src="https://github.githubassets.com/favicons/favicon.svg" width="16" height="16" style="vertical-align: middle; border: none;">
                    </a>
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closePopup()">닫기</button>
            </div>
        </div>
    </div>

    <!-- 모자이크 지도가 표시될 영역 -->
    <div id="AndreaMosaic"></div>

    <!-- 라이브러리 스크립트 -->
    <script src="app/leaflet.js"></script>
    <script src="app/leafletzoom.js"></script>  
    <script src="app/Control.FullScreen.js"></script>  
    <script src="app/easy-button.js"></script>  
    <script src="app/leaflet-search.js"></script>
    <script>
                // --- 팝업 제어 스크립트 ---
        const modal = document.getElementById('myModal');

        window.onload = function() {
            // 접속 시 무조건 팝업 노출 (localStorage 로직 제거)
            modal.style.display = 'flex';
        };

        // 팝업 닫기 함수: 단순히 창을 닫는 기능만 수행
        function closePopup() {
            modal.style.display = 'none';
        }
        // --- 팝업 제어 끝 ---
    </script>
    <script type="application/javascript">
        // --- 원래의 AndreaMosaic 관련 설정 코드 ---
        var tileArrays = [];

        var getTileObject = function (x,y) {
            var l = tileArrays.length;
            for (n=0; n<l; ++n) {
                tileInfo = tileArrays[n];
                if (tileInfo[0] <= x && tileInfo[0]+tileInfo[2] >= x && tileInfo[1] <= y && tileInfo[1]+tileInfo[3] >= y) {
                    return { 
                        tileLeft:tileInfo[0],
                        tileTop:tileInfo[1],
                        tileWidth:tileInfo[2],
                        tileHeight:tileInfo[3],
                        tileRight:tileInfo[0]+tileInfo[1],
                        tileBottom:tileInfo[2]+tileInfo[3],
                        tileNr:tileInfo[4],
                        imageNr:tileInfo[5],
                        imageUsageCount:tileInfo[6],
                        imageUrl:tileInfo[7],
                        imageName:tileInfo[8],
                        imageExtension:tileInfo[9],
                    };
                }
            }
            return null;
        }

        var showPopUpWindow = function(popUpText, callback) {
            callback.showPopUp({maxWidth:300, popUpText:popUpText}, callback.args);
        }

        var getPopUpFullText = function (x,y,callback) {
            var tile = getTileObject(x,y);
            var popUpText = tile === null ? "No information available" :
                        (tile.imageUrl == null? '' : '<a href="' + tile.imageUrl + '" target="TileImage"><img src="' + tile.imageUrl + '" width=300 /><br></a>')
                        + 'Tile Nr.: ' + tile.tileNr + '<br>'
                        + 'Tile Size: ' + tile.tileWidth + ' x ' + tile.tileHeight + '<br>'
                        + 'Tile Position: ' + tile.tileLeft + ' x ' + tile.tileTop + '<br>'
                        + 'Image Name: ' + tile.imageName + '<br>'
                        + 'Image Usage Count: ' + tile.imageUsageCount + '<br>';
            showPopUpWindow(popUpText,callback);
        };

        var getHelpText = function () {
            return {
                maxWidth: 500,
                minWidth: 300,
                popUpText: '<table class="help-table"><thead><tr><th></th><th>Mouse</th><th>Touchscreen</th><th>Keyboard</th></tr></thead><tbody>' 
                            + '<tr><td>Zoom In</td><td>Wheel or Doubleclick</td><td>Enlarge with two Fingers</td><td>+</td></tr>'
                            + '<tr><td>Zoom Out</td><td>Wheel or Shift + Doubleclick</td><td>Reduce with two Fingers</td><td>-</td></tr>'
                            + '<tr><td>Pan</td><td>Left Click + Move</td><td>Short Press + Move</td><td>Arrow Keys</td></tr>'
                            + '</tbody></table>',
            }
        }; 

        var getSearchText = function () {
            var l = tileArrays.length;
            var searchList = new Array(l);
            for (n=0; n<l; ++n) {
                tileInfo = tileArrays[n];
                searchList[n] = [tileInfo[0]+tileInfo[2]/2, tileInfo[1]+tileInfo[3]/2, tileInfo[8]];
            }
            return searchList;
        };

        var mapOptions = {
            getPopUpText: getPopUpFullText,
            getHelpText: getHelpText,
            attribution: "Mosaic created by AndreaMosaic",
            keepPopUpInView: true,
            fullscreenControl: !navigator.vendor.match(/apple/i),
            getSearchText: getSearchText,
            zoomControl: true,
        };

        // 지도 생성 실행
        ShowAndreaMosaic(
            'AndreaMosaic', 
            'mosaic/', 
            11904, 
            6690, 
            mapOptions
        );
    </script>
</body>
</html>